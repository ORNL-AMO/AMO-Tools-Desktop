<div class="row">
    <div class="col-6">
<div class="mt-auto">
        <label class="semibold form-section-label mb-2">
            Search For Weather Stations
        </label>
        <ol class="small">
             <li>
                Choose the lookup method used to find locations.
            </li>
            <li>
                Adjust the furthest distance to search. Results can be found up to {{maxSearchDistance}} miles away.
            </li>
            <li>
                Select the location from the table populated on the right.
            </li>
        </ol>
    </div>
    </div>
    <div class="col-6">
        <div class="d-flex flex-column ml-3">
        <label class="semibold">Lookup Method</label>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions" id="locationSearch"
                [(ngModel)]="isLocationSearch" [value]="true" (ngModelChange)="clearStations()">
            <label class="form-check-label" for="locationSearch">Location Search</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions" id="latLongEntry"
                [(ngModel)]="isLocationSearch" [value]="false" (ngModelChange)="clearStations()">
            <label class="form-check-label" for="latLongEntry">Lat/Long Entry</label>
        </div>
    </div>
    </div>
</div>
<hr>
<form>
    <div class="row">
        <div class="col-6">
            @if (useDevelopmentMock) {
            <div class="alert alert-warning p-2 small">
                Local Development mode: using Mock Weather API data
            </div>
            }
            <ng-template [ngIf]="isLocationSearch" [ngIfElse]="latLongSearchBlock">
                <div class="row">
                    <div class="col-12">
                        <label class="w-100 form-section-label" for="address">Location Search</label>
                        <p class="fw-light mb-0 small">
                            Enter an address, city, state, or zip code to find corresponding locations.
                        </p>
                        <input type="text" class="form-control" name="addressString" id="addressString"
                            [(ngModel)]="addressString" [disabled]="fetchingData">
                    </div>
                    <div class="col-12">
                        <label class="semibold" for="furthestDistance">Furthest Distance</label>
                        <div class="input-group mb-3">
                            <input type="number" class="form-control" name="furthestDistance" id="furthestDistance"
                                [(ngModel)]="furthestDistance" (input)="clearStations()" [disabled]="fetchingData"
                                [max]="150">
                            <span class="input-group-addon units">miles</span>
                        </div>
                        <div class="alert-danger alert" *ngIf="furthestDistance > 150">
                            For performance reasons we cannot map further than 150 miles.</div>
                    </div>
                    <div class="col-12 mt-2">
                        <div class="pull-right" *ngIf="!fetchingData">
                            <button class="btn action-btn btn-sm btn-primary" (click)="getLocationAndStations()"
                                [disabled]="!addressString && !searchingLatLong">
                                <span class="fa fa-search"></span> Search
                            </button>
                        </div>
                    </div>
                </div>
            </ng-template>
            <ng-template #latLongSearchBlock>
                <div class="col-12">
                    <label class="semibold" for="latitude">Latitude</label>
                    <input class="form-control" type="number" [(ngModel)]="addressLatLong.latitude" name="latitude"
                        id="latitude">
                </div>
                <div class="col-12">
                    <label class="semibold" for="longitude">Longitude</label>
                    <input class="form-control" type="number" [(ngModel)]="addressLatLong.longitude" name="longitude"
                        id="longitude">
                </div>
                <div class="col-12">
                    <label class="semibold" for="furthestDistance">Furthest Distance</label>
                    <div class="input-group mb-3">
                        <input type="number" class="form-control" name="furthestDistance" id="furthestDistance"
                            [(ngModel)]="furthestDistance" (input)="clearStations()" [disabled]="fetchingData" [max]="150">
                        <span class="input-group-addon units">miles</span>
                    </div>
                    <div class="alert-danger alert" *ngIf="furthestDistance > 150">
                        For performance reasons we cannot map further than 150 miles.</div>
                </div>
                <div class="col-12 mt-2">
                    <div class="pull-right" *ngIf="!fetchingData">
                        <button class="btn action-btn btn-sm btn-primary" (click)="getLocationAndStations()"
                            [disabled]="!addressString && !searchingLatLong">
                            <span class="fa fa-search"></span> Search
                        </button>
                    </div>
                </div>
            </ng-template>
        </div>
        <div class="col-6">
            <ng-template [ngIf]="!searchingLatLong" [ngIfElse]="searchingLatLongBlock">
                <ng-template [ngIf]="isLocationSearch">
                    <label class="w-100 form-section-label">
                        Select Location
                    </label>
                    <p class="fw-light mb-0 small">
                        Weather stations can be found using geocoordinates.
                    </p>
                    <table class="table table-sm table-bordered w-100">
                        <thead class="small">
                            <tr>
                                <th>

                                </th>
                                <th>
                                    Type
                                </th>
                                <th>
                                    Display Name
                                </th>
                                <th>
                                    (Latitude, Longitude)
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (!addressLookupItems) {
                            <tr>
                                <td colspan="4" class="small text-center">
                                    Use search to the left to find list of corresponding locations to choose from.
                                </td>
                            </tr>
                            } @else if (addressLookupItems.length > 0) {
                            <tr class="small" *ngFor="let item of addressLookupItems">
                                <td>
                                    <!-- * Hidden - only TMY is used -->
                                    <!-- <div class="form-check">
                                           <input class="form-check-input" type="radio" name="selectedLocationId"
                                               [(ngModel)]="selectedLocationId" id="{{item.place_id}}"
                                               [value]="item.place_id" (change)="setLatLongFromItem(item)">
                                       </div> -->
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="selectedLocationId"
                                            [(ngModel)]="selectedLocationId" id="{{item.place_id}}"
                                            [value]="item.place_id" (change)="setTMYStations()">
                                    </div>
                                </td>
                                <td>
                                    {{item.addresstype}}
                                </td>
                                <td>
                                    {{item.display_name}}
                                </td>
                                <td>
                                    ({{item.lat | number:'1.4-4'}}, {{item.lon | number:'1.4-4'}})
                                </td>
                            </tr>

                            } @else if (addressLookupItems.length == 0) {
                            <tr>
                                <td colspan="4" class="small text-center">
                                    No results found. Update terms or increase search distance.
                                </td>
                            </tr>
                            }

                        </tbody>
                    </table>
                    <hr class="my-1">
                </ng-template>
                <!-- * hidden - only using TMY3  -->
                <!-- <div>
                    <div class="pull-right" *ngIf="!fetchingData">
                        <button class="btn action-btn btn-sm btn-primary" (click)="setStations()"
                            [disabled]="furthestDistance > 150 || addressLatLong.latitude == undefined|| addressLatLong.longitude == undefined">
                            Fetch Stations
                        </button>
                    </div>
                </div> -->
            </ng-template>
            <ng-template #searchingLatLongBlock>
                <app-loading-spinner [message]="'Searching Locations...'"></app-loading-spinner>
            </ng-template>
        </div>
    </div>
</form>
<hr>
<div class="row" *ngIf="fetchingData && !stationSearchError">
    <div class="col-12 text-center pb-4">
        <app-loading-spinner [message]="'Fetching Stations...'"></app-loading-spinner>
    </div>
</div>
<ng-template [ngIf]="stations.length > 0" [ngIfElse]="noStationsBlock">
    <app-weather-stations-table [stations]="stations"></app-weather-stations-table>
    <app-weather-stations-map [stations]="stations" [furthestDistance]="furthestDistance"
        [addressLatLong]="addressLatLong" [stateLines]="stateLines"></app-weather-stations-map>
</ng-template>
<ng-template #noStationsBlock>
    <!-- <ng-template [ngIf]="!stationSearchError" [ngIfElse]="stationSearchErrorBlock">
        <div class="alert alert-info p-2 small" *ngIf="!fetchingData">
            Set or search for the latitude and longitude of a location and then click "Fetch Stations" to get a list of
            weather stations with
            hourly weather data.
        </div>
    </ng-template> -->
    <ng-template #stationSearchErrorBlock>
        <div class="alert alert-danger p-1 small">
            An error occured while searching for stations. Please make sure the Lat/Long selection is correct. Notify
            the MEASUR team if this error persists.
        </div>
    </ng-template>
</ng-template>